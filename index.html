<!DOCTYPE html>
<html><head>
  
  <meta charset="utf-8">

  
  <meta http-equiv="X-UA-Compatible" content="chrome=1">

  
  <link href="https://fonts.googleapis.com/css?family=Chivo:900" rel="stylesheet" type="text/css">

  
  <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">

  
  <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen">

  
  <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

<!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  <title>Keyfobsimulation by chipk215</title>

  
</head><body>
<div id="container">
<div class="inner"> <header> </header>
<h1>Key Fob Simulation</h1>
<h2>TI Key Fob Simulator</h2>
<section id="downloads" class="clearfix"> <a href="https://github.com/chipk215/keyfobsimulation/zipball/master" id="download-zip" class="button"><span>Download .zip</span></a> <a href="https://github.com/chipk215/keyfobsimulation/tarball/master" id="download-tar-gz" class="button"><span>Download .tar.gz</span></a> <a href="https://github.com/chipk215/keyfobsimulation" id="view-on-github" class="button"><span>View on GitHub</span></a></section>
<br>
<table style="text-align: left; width: 569px; height: 312px;" border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top;"><img src="images/keyfobnobg.png" style="width: 181px; height: 275px;" alt="Key Fob Image"></td>
      <td style="vertical-align: top;"><img src="images/screenshot.PNG" style="width: 176px; height: 280px;" alt="Screen Shot"></td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><small><small><small><small><small><small><small><small>TI
Key
Fob&nbsp;</small></small></small></small></small>&nbsp; <br>
      </small></small></small></td>
      <td style="vertical-align: top;"><small><small><small> Simulator
Screen Shot</small></small></small></td>
    </tr>
  </tbody>
</table>
<br>
<br>
<h1>iOS Key Fob Simulator</h1>
The iOS Key Fob Simulator simulates the key fob peripheral that
comes with the CC2540 Mini Development Kit from Texas Instruments. The
simulator enables an iPhone to masquerade as a key fob peripheral
providing accelerometer data, key press notifications, battery level
data, a dual tone immediate alert and transmit power data. Master
devices (Centrals) which can connect to a key fob peripheral should
also be able to discover and connect to the simulator without any
modifications.<br>
<br>
The simulator requires the hosting iOS device to support Bluetooth 4.0.
iPhone models beginning with the 4S and 3rd generation iPads are
capable of hosting the simulator.<br>
<br>
The services and characteristics of the simulator are described below.
The simulator fails the Turing test compared to an actual key fob in
specific use cases which are documented.&nbsp; However, the
simulator does enable some test cases that are not possible using the
key fob hardware. The simulator is a complementary tool for developers
working with the CC2540 Mini Development Kit.<br>
<br>
<h2>Quick Start </h2>
After launching the simulator, slide the Advertising Switch depicted on
the screen shot to the ON position. Discover and connect to the
simulator using any Bluetooth Low Energy (BLE) Device Scanner.&nbsp;
See references at the bottom of the page for BLE device scanners.<br>
<br>
<span style="font-weight: bold;">Left Key Functionality</span><br>
The key fob hardware uses the left and right keys to change the
internal state of the key fob.&nbsp; For example pressing the right key
on the key fob initiates advertising for a 30 second interval.&nbsp;
The simulator provides a much more visible ON/OFF switch to control
advertising and does not mimic the hardware behavior of the right key.<br>
<br>
The left key behavior does carry over to the simulator.&nbsp; Left key
presses toggle the value of the Transmit Power between 0 dBm and -6 dBm
as described in the Tx Power Service description. The left key also
provides the user a manual override to quiet an active Immediate Alert.<br>
<br>
<h2>Published Services and Characteristics</h2>
The hardware version of the key fob exposes nine services:<br>
<br>
Generic Access Service &nbsp;&nbsp;&nbsp; &nbsp; (0x1800)<br>
Generic Attribute Service&nbsp;&nbsp;&nbsp;&nbsp; (0x1801)<br>
Immediate Alert Service&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; (0x1802)<br>
Link Loss
Service&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp; &nbsp; (0x1803)<br>
Tx Power Level Service&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; (0x1804)<br>
Device Information Service&nbsp; (0x180A)<br>
Battery
Service&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; (0x180F)<br>
Accelerometer Service&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
(0xFFA0)<br>
Simple Keys Service&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp; (0xFFE0)<br>
<br>
The first seven services are <a style="color: rgb(51, 102, 255);" href="http://developer.bluetooth.org/gatt/services/Pages/ServicesHome.aspx" target="_blank">Registered GATT Services</a>&nbsp;
with the Bluetooth SIG&nbsp; while the Accelerometer and Simple Keys
services are custom service implementations by TI and do not conform to
any standard profile specification.&nbsp; TI used 16 bit UUIDS for the
custom services rather than assigning 128 bit UUIDs per the Bluetooth
4.0 specification.<br>
<br>
The simulator exposes only seven of the listed key fob services. The
Link Loss Service is not implemented in the simulator because&nbsp; the
iOS Core Bluetooth Framework does not currently (iOS SDK: iOS 6.1)
provide a mechanism for a slave device to determine when a connection
to a master device is terminated.&nbsp; There are also defects in the
Core Framework which prevent implementing the Generic Access Service in
the simulator to match the prescribed behavior of the Generic Access
Service implemented by the hardware version of the key fob.&nbsp; These
issues will be highlighted in the discussions which follow.<br>
<br>
<h3>Generic Access Service (0x1800)</h3>
The Generic Access Service is a mandatory GATT service which all
peripherals must implement. The five service characteristics are each
Read only with only two of the characteristics (Device Name and
Appearance) required to be implemented to be compliant with the GATT
specification.<br>
<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="font-weight: bold;">Generic
Access Service Characteristics</span><br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; Device
Name&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; (0x2A00)<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
Appearance&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; (0x2A01)<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; Peripheral
Privacy Flag&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; (0x2A02)<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; Reconnection
Address&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; (0x2A03)<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; Preferred
Connection Parameters&nbsp;&nbsp;&nbsp; (0x2A04)<br>
<br>
The key fob hardware&nbsp; implements each of these characteristics
with zero values returned for Appearance, Privacy Flag, and the
Reconnection Address.&nbsp; The Preferred Connection Parameters
characteristic returns a value of 0x5000A0000000E803.<br>
<br>
The iOS Core Bluetooth Framework appears to have a defect associated
with reading the Device Name characteristic associated with the Generic
Access Service.&nbsp; An error indicating the Device Name is unreadable
is always returned when this characteristic is read. The error is
returned on every peripheral device I have tested including peripheral
implementations developed using Apple's CBPeripheralManager class in
which the framework provides the Generic Access Service and
corresponding Device Name characteristic automatically. <br>
<br>
As&nbsp; noted, when a peripheral/slave is implemented using the Core
Bluetooth Framework, and specifically the CBPeripheralManager Class,
the Generic Access Service is automatically created and exposed by the
framework itself.&nbsp; The Appearance Characteristic value provided by
the framework corresponds to "Generic Phone" which corresponds to the
hosting platform. <br>
<br>
At this point I have not researched whether the characteristic values
provided by the iOS Core Bluetooth Framework can be modified by the
application before communicating to the Master/Central client.<br>
<br>
<h3>Generic Attribute Service (0x1801)</h3>
The Generic Attribute Service is a mandatory GATT service which is
comprised of a single control-point characteristic which can not be
read but only indicated (notification + response confirmation).<br>
<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; <span style="font-weight: bold;">Generic
Attribute Service Characteristic</span><br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Service
Changed (0x2A05)<br>
<br>
The key fob hardware provides the required characteristic definition. I
did not experiment with subscribing for indications for the Service
Changed characteristic as it was not germane to the key fob
functionality.<br>
<br>
In a manner similar to the Generic Access Service, the Core Bluetooth
Framework automatically provides and publishes the Generic Attribute
Service for peripheral applications using the CBPeripheralManager
Class.&nbsp; The Service Changed characteristic is provided and
available for indication subscription.<br>
<br>
<h3>Immediate Alert Service (0x1802)</h3>
The Immediate Alert Service is a registered GATT service and exposes a
single characteristic:<br>
<br>
&nbsp;&nbsp;<span style="font-weight: bold;"> Alert Service
Characteristic</span><br>
<div style="margin-left: 40px;">Alert Level&nbsp; (0x2A06)&nbsp; <br>
</div>
<br>
Alert Level is defined to be a "Write Without Response" characteristic
meaning that the Master device should be able to write a value to the
Alert Level characteristic specifying that no return response from the
peripheral is desired.&nbsp; Three alert level values can be written to
the Alert Level Characteristic:<br>
<br>
<div style="margin-left: 40px;"><span style="font-weight: bold;">Alert
Level Values</span><br>
</div>
<div style="margin-left: 80px;">No Alert<br>
</div>
<div style="margin-left: 80px;">Mild Alert<br>
</div>
<div style="margin-left: 80px;">High Alert<br>
</div>
<br>
Writing a "No Alert" value quiets the key fob while the "Mild Alert"
and "High Alert" values result in two distinct tones to be sounded for
10 seconds on the key fob. A low frequency tone is associated with
"Mild Alert" with a higher frequency tone played for a "High
Alert".&nbsp; In both cases, the tones are accompanied by a blinking
LED indicator. <br>
<br>
The user can manually quiet the key fob when an alert is occurring by
pressing the left key on the fob.<br>
<br>
Immediate Alert Service Simulator Implementation Issues<br>
The specification also requires that the alert be turned off if the
physical connection to the key fob is terminated. The simulator can not
detect a terminated physical connection and therefore can not turn off
an active alert when a connection is terminated. An active alert will
turn off after 10 seconds or by manually turning off the alert using
the left key on the fob.<br>
<br>
A defect in the Core Bluetooth Framework prevents "Write Without
Response" type writes to be delivered to the peripheral. &nbsp; The
work-around requires
the Master device to Write to the characteristic and request a
confirmational response indicating that the write occurred (or
failed).&nbsp; This of course, violates the Bluetooth Specification for
the Immediate Alert Service.<br>
<br>
<h3>Link Loss Service (0x1803)</h3>
As noted in the introductory section above, the simulator can not
implement the Link Loss Service because the iOS Core Bluetooth
Framework does not provide a mechanism for detecting a terminated&nbsp;
or dropped connection between the peripheral and its connected client.<br>
<br>
<h3>Tx Power Level Service (0x1804)</h3>
The Power Level Service is also a registered GATT service and exposes a
single Read Only characteristic:<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="font-weight: bold;">Tx Power Service Characteristic</span><br>
<div style="margin-left: 80px;">Tx Power Level (0x2A07)<br>
</div>
<br>
The Tx Power Level characteristic returns the transmit power of the key
fob in dBm. The key fob peripheral transmits at either the 0 dBm level
or at the -6 dBm level. The user can chose the transmit level by
pressing the left key on the fob. Left key presses on the fob toggle
between the two transmit levels.<br>
<br>
The simulator behavior mirrors the key fob hardware behavior in that
the Tx Power Level characteristic returns either 0 dBm or -6 dBm. The
simulator also enables the user to select the transmit power level
reported by the characteristic by toggling the left key in the same
manner as the hardware key fob.&nbsp; The simulator is not capable of
adjusting the actual transmit power of the iOS device, the simulator
simply models the behavior of the Tx Power Level characteristic.<br>
<span style="font-weight: bold;"><br>
</span>
<h3><span style="font-weight: bold;">Device Information </span>Service
(0x180A)</h3>
The GAT registered Device Information Service provides manufacturer or
vendor information about a device. Though the key fob hardware exposes
this service the data values the service provides are simply
placeholders for the corresponding characteristics.&nbsp; Each of the
characteristics defined by the Device Information Service are Read only
and none are required to be implemented since each characteristic is
considered optional.<br>
<br>
<div style="margin-left: 40px;"><span style="font-weight: bold;">Device
Information Service Characteristics</span><br>
</div>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; <br>
<table style="width: 465px; height: 249px;" border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="width: 257px; text-align: left;"><small><small><small><small><small><small><small><small><small>Manufacturer
Name String</small></small></small></small></small></small></small></small></small></td>
      <td style="width: 235px;">(0x2A29)</td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="width: 257px; text-align: left;">Model Number
String</td>
      <td style="width: 235px;">(0x2A24)</td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="width: 257px; text-align: left;">Serial Number
String</td>
      <td style="width: 235px;">(0x2A25)</td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="width: 257px; text-align: left;">Hardware
Revision String</td>
      <td style="width: 235px;">(0x2A27)</td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="width: 257px; text-align: left;">Firmware
Revision String </td>
      <td style="width: 235px;">(0x2A26)</td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="width: 257px; text-align: left;">Software
Revision String</td>
      <td style="width: 235px;">(0x2A28)</td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="width: 257px; text-align: left;">System
ID </td>
      <td style="width: 235px;">(0x2A23)</td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="width: 257px; text-align: left;">Regulatory
Certification Data List</td>
      <td style="width: 235px;">(0x2A2A)</td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="width: 257px; text-align: left;">PnP
ID </td>
      <td style="width: 235px;">(0x2A50)</td>
    </tr>
  </tbody>
</table>
<br>
The key fob hardware implements each of these characteristics but
simply echoes the&nbsp; characteristic name for the string attributes
without providing any real data.&nbsp; Examples:<br>
<br>
<table style="text-align: left; width: 496px; height: 125px;" border="5" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top;">Manufacturer Name<br>
      </td>
      <td style="vertical-align: top;">"Manufacturer Name"<br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">Mode Number<br>
      </td>
      <td style="vertical-align: top;">"Model Number"<br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">Serial Number<br>
      </td>
      <td style="vertical-align: top;">"Serial Number"<br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">etc.<br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
    </tr>
  </tbody>
</table>
<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="font-weight: bold;"></span><br>
<br>
The keyfob hardware does provide data for the non-string type
characteristics.<br>
<br>
The simulator provides a high fidelity simulation for the Device
Information Service as illustrated in the screen snapshots captured
from a BLE client connected to both the hadware Key Fob and the
simulated key fob:<br>
<br>
<div style="margin-left: 40px;">&nbsp; &nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; <img src="images/keyfobDevSvc.PNG" style="width: 583px; height: 654px;" alt="keyfob hardware device service"><br>
</div>
<h5>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; Key Fob Hardware
Device Information Service</h5>
<br>
<div style="margin-left: 40px;">&nbsp; &nbsp;&nbsp;&nbsp; <img src="images/simDevSvc.PNG" style="width: 603px; height: 704px;" alt="simulator device service"></div>
<h5>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; Key Fob
Simulator Device Information Service<br>
</h5>
&nbsp; <br>
The data is identical except the Simulator uses all uppercase for the
character strings simply to distinguish the output if needed.<br>
<span style="color: rgb(255, 153, 0);"></span><br>
<h3>Battery Service (0x180F)</h3>
The GATT registered Battery Service exposes a single characteristic
which returns the percentage of remaining battery life. A fully charged
battery returns 100 while a completely discharged battery returns 0.<br>
<br>
<div style="margin-left: 40px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold;"> Battery Service Characteristic</span><br>
</div>
<div style="margin-left: 40px;">
<div style="margin-left: 40px;">&nbsp;&nbsp;&nbsp;&nbsp; Battery Level
(0x2A19)<br>
</div>
</div>
<div style="margin-left: 80px;"><br>
</div>
The characteristic can be read as required by the Bluetooth SIG and can
also be subscribed to as TI implemented the optional notification
support in the key fob hardware.<br>
<br>
The simulator also supports both reading and notification subscription
to obtain the battery level.&nbsp; The battery level is set with the
slider control shown on the screen shot. As the slider control is moved
by the user the updated value of the slider is immediately pushed to
subscribers of the Battery Level characteristic. Otherwise, the battery
level will be returned to the client when the characteristic is read.<br>
<br>
The simulator's ability to change the battery level on demand provides
an easy testing mechanism for device scanners wanting to test receiving
updates for a characteristic value that typically changes very
infrequently.<br>
<br>
<h3>Accelerometer Service (0xFFA0)</h3>
The Accelerometer Service is a custom service defined by TI which
provides accelerometer control (enable/disable) and accelerometer data
for a tri-axial accelerometer that is embedded in the key fob.&nbsp;
The Accelerometer Service exposes four characteristics:<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;
&nbsp;
<span style="font-weight: bold;">Accelerometer Service Characteristics</span><br>
<div style="margin-left: 40px;">Accelerometer
Enable&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
(0xFFA1)<br>
</div>
<div style="margin-left: 40px;">Accelerometer Dynamic Range&nbsp;
(0xFFA2)<br>
</div>
<div style="margin-left: 40px;">Accelerometer X Axis
Data&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
(0xFFA3)<br>
</div>
<div style="margin-left: 40px;">Accelerometer Y Axis
Data&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
(0xFFA4)<br>
</div>
<div style="margin-left: 40px;">Accelerometer Z Axis
Data&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; (0xFFA5)<br>
<br>
</div>
The Accelerometer Enable characteristic is a Read+Write characteristic.
A non zero value written to the characteristic enables the
accelerometer which then begins generating data. A zero value written
to the accelerometer turns the accelerometer off.&nbsp; The simulator
models this same behavior.<br>
<br>
The Dynamic Range characteristic is a Read only characteristic which
returns an encoded value representing the dynamic range of the
accelerometer.&nbsp; The firmware version of the key fob hardware that
I have loaded in the fob does not allow changing the dynamic range of
the accelerometer and is set to 2G's corresponding to +/- 1G.&nbsp; TI
encodes the dynamic range value using the decimal integer value of 20
to represent a 2G dynamic range. The firmware is capable of
representing an 8G dynamic range by returning a decimal integer value
of 80.&nbsp; The simulator always returns a decimal integer value of 20
for this characteristic.<br>
<br>
Accelerometer X-Y-Z characteristics can be read or subscribed to for
notification.&nbsp; Each axis must be independently read or
subscribed.&nbsp; Accelerometer data is scaled to 8 bits for each axis
and does not appear to be preprocessed or filtered.<br>
<br>
The simulator models the key fob accelerometer service by also
providing 3 distinct characteristics corresponding to each
accelerometer axis.&nbsp; Additionally, an accelerometer characteristic
only provided by the simulator is exposed:<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="font-weight: bold;">Additional
Simulator Only Accelerometer Characteristic</span><br>
<div style="margin-left: 80px;">Tri-Axial Accelerometer
Data&nbsp;&nbsp; (0xFFAA)<br>
<br>
</div>
The Tri-Axial Accelerometer Data packages all three accelerometer
components in the same transmission packet.&nbsp; This enables three
value to be sent in one atomic packet and eliminates the inter-packet
delay required between packets for individual component
transmissions.&nbsp; The inter-packet delay is still required between
distinct samples of the accelerometer, but eliminates inserting the
delay when sending X, then Y, then Z in succession. <br>
<br>
The simulator updates clients with accelerometer data at a rate of 15
Hz.<br>
<br>
<h3>Simple Keys Service (0xFFE0)</h3>
The Simple Key Service is another custom service defined by TI which
enables the remote monitoring of the two keys that are found on the key
fob.&nbsp; A single characteristic is exposed by the service which
supports subscriptions for notifications of the state changes
associated with the keys:<br>
<br>
<div style="margin-left: 80px;"><span style="font-weight: bold;">Key
Press Service Characteristic</span><br>
<div style="margin-left: 40px;">Key Press State&nbsp; (0xFFE1)<br>
</div>
</div>
<br>
The Key Press State encodes four values. A value of 0x00 indicates that
neither key is pressed.&nbsp; A value of 0x01 indicates that the left
key is pressed. A value of 0x02 indicates the right key is pressed. The
final value, 0x03 indicates that both keys are pressed.<br>
<br>
The simulator uses two button controls for the user to press which
reside to the left and right of the image of the body of the key fob.
When a button is pressed, the corresponding red LED indicator
representing the key on the body of the fob illuminates with a yellow
light. <br>
<br>
<br>
<h2>Advertising Functionality</h2>
The key fob hardware advertises three primary services along with a
local name, RSSI and a device UUID as depicted in the captured screen
shot from a BLE scanner :<br>
<br>
<img src="images/croppedfobadvertise.png" style="width: 768px; height: 569px;" alt="key fob advertisement"><br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;Key Fob Hardware Advertisement<br>
<br>
The actual broadcasted advertisement data is listed in the bottom
section of the display. The key fob peripheral advertises three primary
services corresponding to the Immediate Alert Service, Transmit Power
Service, and Link Loss Service in addition to the local name
"Keyfobdemo".&nbsp; The choice TI made to advertise these three
services in the limited advertising space available probably coincides
with the key fob's conformance to the GATT defined Proximity Profile.
The Proximity Profile relies on the implementation of these three
services.<br>
<br>
The simulator advertises a different set of services due to the
inability to implement LInk Loss. The TI defined custom Accelerometer
and Key Press services make up the advertised services for the
simulator as shown here:<br>
<br>
<img src="images/simAdvert.png" style="width: 728px; height: 525px;" alt="simulator advertising"><br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Simulator
Advertising Data<br>
<br>
<br>
<h2><span style="font-weight: bold;">Summary of Issues</span></h2>
The iOS Key Fob Simulator falls short of being a high fidelity
simulator in three areas:<br>
<br>
&nbsp;&nbsp; 1)&nbsp; Link Loss - inability to detect a terminated
connection by the simulator.<br>
&nbsp;&nbsp;&nbsp; <br>
&nbsp;&nbsp;&nbsp; 2) Generic Access Service Device Name Error - iOS
Framework error prevents the&nbsp;&nbsp;&nbsp; reading the Device Name.
<span style="font-style: italic;">The Apple defect ID number is
13362139.</span><br>
<br>
&nbsp;&nbsp;&nbsp; 3) Write Without Response Error - aside from not
being able to implement Link Loss, the Write Without Response Error
described in the Immediate Alert Service is the most severe issue
uncovered in the Core Bluetooth Framework.&nbsp; iOS peripherals will
simply fail to update writable characteristics that clients have
written using Write Without Response write commands.&nbsp; This defect
must be fixed by Apple before a legitimate product offering can be made
using an iOS based Bluetooth 4.0 peripheral. <span style="font-style: italic;">The Apple&nbsp; defect number is 13361937.</span><br>
<br>
<br>
<h2>Bluetooth Low Energy Scanners </h2>
&nbsp;&nbsp;&nbsp; Available in the App Store:<br>
<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; <a style="text-decoration: underline;" href="https://itunes.apple.com/us/app/lightblue/id557428110?mt=8&amp;ign-mpt=uo%3D4">LightBlue</a>
- a Bluetooth Low Energy Device Scanner<br>
<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; <a style="text-decoration: underline;" href="https://itunes.apple.com/gb/app/ti-ble-multitool/id580494818?mt=8">TI
BLE MultiTool</a> - a nice
scanner which includes graphical data for characteristics<br>
<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; <a style="text-decoration: underline;" href="http://www.byteworks.us/Byte_Works/Collect_Data.html">TechBasic</a>
- a BASIC
environment for iOS devices enabling BASIC programs to be written and
executed on iOS platforms without needing xCode or a developer's
license.<br>
<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <a style="text-decoration: underline;" href="https://github.com/chipk215/ble_scanner">BLE Scanner</a> -
Source Code For BLE Scanner on Git Hub &nbsp; <br>
<br>
<br>
<br>
<hr><section id="main_content"></section><footer>Keyfobsimulation is
maintained by <a href="https://github.com/chipk215">chipk215</a><br>
This page was generated by <a href="http://pages.github.com">GitHub
Pages</a>. Tactile theme by <a href="http://twitter.com/jasonlong">Jason
Long</a>. </footer> </div>
</div>

</body></html>